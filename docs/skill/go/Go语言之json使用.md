---
id: go-json-usage
slug: /go-json-usage
title: Goè¯­è¨€ä¹‹jsonä½¿ç”¨
date: 2022-05-20
authors: kuizuo
tags: [go, json]
keywords: [go, json]
---

<!-- truncate -->

Go è¯­è¨€ä¸­ï¼Œå®˜æ–¹æä¾›äº†ä¸€ä¸ªä¸“é—¨çš„åŒ… `encoding/json`

## json ååºåˆ—ï¼ˆè§£æï¼‰

å‡è®¾æœ‰è¿™æ ·ä¸€ä¸ª json æ•°æ®ï¼Œæˆ‘è¦å°†å…¶è§£æä¸º go ç»“æ„ä½“

```json
{ "name": "kuizuo", "age": 20 }
```

é¦–å…ˆéœ€è¦å®šä¹‰ç»“æ„ä½“ï¼Œé€šå¸¸å¯ä»¥ä½¿ç”¨ json è½¬ go ç»“æ„ä½“çš„[åœ¨çº¿å·¥å…·](https://mholt.github.io/json-to-go/)ï¼Œå¦‚ä¸‹å›¾

![json-to-go.png (1582Ã—248) (kuizuo.cn)](https://img.kuizuo.cn/json-to-go.png)

å…¶è½¬åŒ–ä»£ç å¦‚ä¸‹

```go
import (
  "encoding/json"
  "fmt"
)

type Person struct {
  Name string `json:"name"`
  Age  int    `json:"age"`
}

func main() {
  var p Person

  jsonString := `{"name": "kuizuo", "age" : 20}`

  err := json.Unmarshal([]byte(jsonString), &p)

  if err == nil {
    fmt.Println(p.Name)
    fmt.Println(p.Age)
  } else {
    fmt.Println(err)
  }
}

```

**ä¸»è¦æ­¥éª¤**

- å®šä¹‰ç»“æ„ä½“ï¼ˆä¸€èˆ¬ç»“æ„ä½“çš„æ¯ä¸ªå­—æ®µç¬¬ä¸€ä¸ªå­—æ¯å¤§å†™ï¼‰ï¼Œå¹¶æ–°å»º**ç»“æ„ä½“å˜é‡**
- æ ¸å¿ƒä»£ç `err := json.Unmarshal([]byte(jsonString), &p)`ï¼Œå¦‚æœè§£ææœ‰æ•ˆé‚£ä¹ˆ err ä¸º nilï¼Œå¹¶å°† p èµ‹å€¼å…¶ json æ•°æ®ã€‚
- è®¿é—®ç»“æ„ä½“ p çš„æˆå‘˜

### è§£æ json æ•°ç»„

å¦‚æœè¦è§£æ json æ•°ç»„ï¼Œå…¶æ­¥éª¤åŒä¸Šï¼Œæ¼”ç¤ºä»£ç å¦‚ä¸‹

```go
import (
  "encoding/json"
  "fmt"
)

type Person struct {
  Name string `json:"name"`
  Age  int    `json:"age"`
}

func main() {
  var persons []Person

  jsonString := `[{"name": "kuizuo", "age" : 20},{"name": "ğŸ“ºå°šå®‡", "age" : 22}]`

  err := json.Unmarshal([]byte(jsonString), &persons)

  if err == nil {
    for _, p := range persons {
      fmt.Print("\t\n", p.Name)
      fmt.Print("\t", p.Age)
    }
  } else {
    fmt.Println(err)
  }
}

```

å“ªæ€•å¯¹äºå†å¤æ‚çš„ json æ•°æ®ï¼Œéƒ½è¦å…ˆå°† json è½¬ä¸º go ç»“æ„ä½“ï¼Œç„¶åæ‰§è¡Œ`json.Unmarshal`ã€‚

### è‡ªå®šä¹‰å±æ€§åç§°çš„æ˜ å°„

å‡è®¾ json çš„ key å€¼å­˜åœ¨ç©ºæ ¼ï¼ˆä¸€èˆ¬æƒ…å†µä¸‹ä¸å¯èƒ½ï¼Œä»¥æˆ‘å¤šå¹´è¯»å†™ json çš„ç»å†éƒ½æ²¡çœ‹åˆ°è¿‡ï¼‰ï¼Œç”±äº go ä¸­æ— æ³•å°†ç©ºæ ¼åšä¸ºå˜é‡æ ‡è¯†ç¬¦ï¼ˆè²Œä¼¼æ²¡æœ‰è¯­è¨€æ”¯æŒç©ºæ ¼å½“æ ‡è¯†ç¬¦ï¼‰ï¼Œè€Œ json-to-go å·¥å…·ä¼šå°†ç©ºæ ¼æ¸…æ¥šï¼Œå¹¶å°†ä¸‹ä¸ªå•è¯é¦–å­—æ¯å¤§å†™ã€‚

```json
{
  "user name": "kuizuo"
}
```

```go
type AutoGenerated struct {
  UserName string `json:"user name"`
}
```

å½“ç„¶ï¼Œè¿™é‡Œçš„ UserName å¯ä»¥éšä¾¿å‘½å go å˜é‡è§„èŒƒçš„åå­—ï¼Œåªè¦`json:"user name"`ä¸å˜ï¼Œç»“æ„ä½“æ˜ å°„çš„è¿˜æ˜¯`user name`å±æ€§ã€‚

### map[string]interface{}

å¯¹äºæœªçŸ¥å±æ€§ï¼Œå¹¶ä¸”ä¸æƒ³å®šä¹‰ç»“æ„ä½“çš„è¯ï¼Œgo æœ‰ä¸ªå¾ˆå…¸å‹çš„è§£å†³æ–¹æ³•æ˜¯é‡‡ç”¨ `map[string]interface{}` ï¼Œåœ¨ä¸€äº›æƒ…å†µï¼ˆä»…ä¸€å±‚ json æ•°æ®ï¼‰ä¸‹ç¡®å®ä¼šæ¯”è¾ƒæ–¹ä¾¿ï¼Œä½†ä¹Ÿä¼šå­˜åœ¨ json å±æ€§ä¸å­˜åœ¨å¯¼è‡´è¯»å–é”™è¯¯çš„æƒ…å†µã€‚

```go
import (
  "encoding/json"
  "fmt"
)

func main() {
  jsonString := `
        {
            "code": 200,
            "data": {
                "username": "kuizuo",
                "age": 20
            }
        }`

  var result map[string]interface{}
  err := json.Unmarshal([]byte(jsonString), &result)
  if err == nil {
    fmt.Println(result["code"])
    username := result["data"].(map[string]interface{})["username"]
    fmt.Println(username)
  } else {
    fmt.Println(err)
  }
}
```

:::tip

åœ¨ Go1.18 æ›´æ–°ä¸­ï¼Œany ä½œä¸ºä¸€ä¸ªæ–°çš„å…³é”®å­—å‡ºç°ã€‚**any æœ¬è´¨ä¸Šæ˜¯ interface{} çš„åˆ«å**

```go
type any = interface{}
```

`map[string]interface{}` ä¹Ÿå¯å†™ä¸º `map[string]any`

:::

## json åºåˆ—åŒ–

æ—¢ç„¶å‰é¢æ˜¯ json è½¬ go ç»“æ„ä½“ï¼Œé‚£è¿™è‚¯å®šæ˜¯å°† go ç»“æ„ä½“è½¬ä¸º jsonã€‚

åŒæ ·çš„ï¼Œæ—¢ç„¶æƒ³è¦ç”Ÿæˆ json æ•°æ®ï¼Œé‚£ä¹ˆä¹Ÿå¯å°†è¦ç”Ÿæˆçš„ json æ•°æ®æ”¾åˆ° json-to-go é‡Œè½¬ä¸º go ç»“æ„ä½“ã€‚å¦‚

```json
{
  "id": 1,
  "username": "kuizuo",
  "hobby": ["æ•²ä»£ç ", "åƒé¥­", "ç¡è§‰"]
}
```

```go
type AutoGenerated struct {
  ID       int      `json:"id"`
  Username string   `json:"username"`
  Hobby    []string `json:"hobby"`
}
```

å¯¹åº”çš„ go ä»£ç å¦‚ä¸‹

```go
import (
  "encoding/json"
  "fmt"
)

type User struct {
  ID       int      `json:"id"`
  Username string   `json:"username"`
  Hobby    []string `json:"hobby"`
}

func main() {
  user := &User{
    ID:       1,
    Username: "kuizuo",
    Hobby:    []string{"æ•²ä»£ç ", "åƒé¥­", "ç¡è§‰"},
  }

  result, _ := json.Marshal(user)
  fmt.Println(string(result))
}
```

**ä¸»è¦æ­¥éª¤**

- å®šä¹‰ç»“æ„ä½“ï¼Œå¹¶æ–°å»º**ç»“æ„ä½“æŒ‡é’ˆ**ï¼ŒåŒæ—¶èµ‹å€¼
- è°ƒç”¨`result, _ := json.Marshal(user)`ï¼Œæ­¤æ—¶çš„ result ä¸ºå­—èŠ‚æ•°ç»„ã€‚
- `string(result)` å°†å…¶è½¬ä¸º json å­—ç¬¦ä¸²

json åºåˆ—åŒ–æ²¡ä»€ä¹ˆè¿‡å¤šè¡¥å……çš„ï¼Œä¸Šé¢è¿™é‡Œä¾‹å­å®é™…ä¸­å·²ç»è¶³å¤Ÿä½¿ç”¨äº†ã€‚

## ç›¸å…³ json åº“

[tidwall/gjson: Get JSON values quickly - JSON parser for Go (github.com)](https://github.com/tidwall/gjson) å¼ºçƒˆæ¨èï¼ˆè¿˜æ”¯æŒ jsonpath è¯­æ³•ï¼‰

## æ€»ç»“

å’Œ js ç›¸æ¯”ï¼Œgo å¯¹ json çš„æ“ä½œå¯ä»¥è¯´æ˜¯æ¯”è¾ƒç¹çï¼Œä½†è¿™å¹¶ä¸æ˜¯åªæœ‰ go è¿™æ ·ï¼Œé™æ€ç±»å‹çš„è¯­è¨€éƒ½ç›¸å¯¹ç¹çã€‚åœ¨ go æ˜¯å®šä¹‰ç»“æ„ä½“ï¼Œè€Œåœ¨ java åˆ™æ˜¯å®šä¹‰ç±»ï¼Œæ¯ç§è¯­è¨€éƒ½æœ‰æ•°æ®æ ¼å¼çš„è§„èŒƒã€‚ä¸è¿‡ json åºåˆ—åŒ–ä¸ååºåˆ—åŒ–è¿˜æ˜¯ js æœ€ä¸ºæ–¹ä¾¿ï¼Œæ¯•ç«Ÿ jsonï¼ˆJavaScript Object Notationï¼‰æœ¬èº«å°±ä½œä¸º js çš„å¯¹è±¡æ•°æ®è¡¨è¾¾å½¢å¼ã€‚
